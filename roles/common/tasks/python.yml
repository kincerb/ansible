---
- name: Setup pipx and install packages
  block:
    - name: Install python packages as user
      pip:
        executable: pip3
        extra_args: --user
        name:
          - pipx

    - name: Install packages with pipx
      community.general.pipx:
        install_deps: true
        state: install
        name: '{{ item }}'
      loop:
        - ansible
        - black
        - ranger-fm

    - name: Inject other tools into black venv
      community.general.pipx:
        state: inject
        name: black
        inject_packages:
          - mypy
          - docformatter
          - isort
          - flake8

    - name: Inject pillow into ranger-fm venv
      community.general.pipx:
        state: inject
        name: ranger-fm
        inject_packages:
          - pillow

    - name: Inject docker and winrm into ansible venv
      community.general.pipx:
        state: inject
        name: ansible
        inject_packages:
          - docker
          - winrm

- name: Create venv for neovim
  ansible.builtin.pip:
    name: '{{ item }}'
    virtualenv: ~/.local/venvs/neovim
    virtualenv_command: python3 -m venv
    state: latest
  loop:
    - pynvim
    - pip
...
