---
- name: Bring in Ubuntu vars
  ansible.builtin.include_vars:
    file: ubuntu.yml

- name: Install common packages
  become: true
  ansible.builtin.apt:
    update_cache: true
    package:
      "{{ common_packages }}"

- name: Install and configure sshd
  become: true
  tags:
    - sshd
    - never
  block:
    - name: Install openssh-server
      ansible.builtin.apt:
        update_cache: true
        package: openssh-server

    - name: Configure sshd
      ansible.builtin.import_tasks: sshd.yml

- name: Setup Homebrew
  become: true
  tags:
    - brew
    - never
  block:
    - name: Download install script
      ansible.builtin.get_url:
        url: https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh
        dest: /tmp/install-homebrew.sh
        mode: '750'

    - name: Run install script
      ansible.builtin.command:
        cmd: /tmp/install-homebrew.sh
        creates: /home/linuxbrew/.linuxbrew

  always:
    - name: Remove install script
      ansible.builtin.file:
        dest: /tmp/install-homebrew.sh
        state: absent
...
# vim: set ft=yaml.ansible ts=2 sts=2 sw=2:
